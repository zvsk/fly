<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Range — Triangle of Velocities</title>
<style>
  /* ===== Dark Theme ===== */
  :root{
    --bg:#0b0c0d;
    --card:#16181a;
    --muted:#8c9197;
    --text:#f6f7f9;
    --glass: rgba(255,255,255,0.05);
    --accent-blue:#2b9cff;
    --accent-green:#3ac77d;
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;}
  .app{max-width:460px;margin:12px auto;padding:14px;box-sizing:border-box;}

  header{margin-bottom:10px;}
  h1{font-size:20px;margin:0;font-weight:800;letter-spacing:-0.02em}
  p.lead{margin:6px 0 0;color:var(--muted);font-size:13px}

  .card{background:var(--card);border-radius:14px;padding:12px;box-shadow:0 6px 20px rgba(0,0,0,0.3);margin-top:12px}
  .row{display:flex;flex-direction:column;gap:8px}
  .label-row{display:flex;justify-content:space-between;align-items:center}
  .label{font-size:13px;color:var(--muted)}
  .value-pill{background:var(--glass);padding:6px 10px;border-radius:10px;font-weight:700;font-size:13px;min-width:68px;text-align:center;color:var(--text)}

  .toggle{display:inline-flex;border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.1)}
  .toggle button{min-width:96px;padding:8px 12px;border:0;background:transparent;font-weight:700;color:var(--muted);font-size:14px}
  .toggle button.active{background:rgba(255,255,255,0.1);color:var(--text)}

  input[type="range"]{width:100%;height:36px;background:transparent;appearance:none}
  input[type="range"]::-webkit-slider-runnable-track{height:8px;border-radius:8px;background:linear-gradient(90deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05))}
  input[type="range"]::-webkit-slider-thumb{appearance:none;margin-top:-7px;width:22px;height:22px;border-radius:50%;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,0.5)}

  .wheel-wrap{display:flex;justify-content:center;padding:12px}
  svg.wheel{width:100%;max-width:360px;height:auto;touch-action:none;user-select:none}

  .output-large{font-size:28px;font-weight:900}
  .output-sub{color:var(--muted);font-size:13px;margin-top:6px}

  footer{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}

  @media (max-width:420px){
    .toggle button{min-width:84px}
    .value-pill{min-width:56px;font-size:12px}
    .output-large{font-size:22px}
  }

  input[type="range"] {
    pointer-events: none; /* Disable pointer events for the entire range input */
  }

  /* Re-enable pointer events for the thumb in WebKit browsers (Chrome, Safari) */
  input[type="range"]::-webkit-slider-thumb {
    pointer-events: all;
  }

  /* Re-enable pointer events for the thumb in Firefox */
  input[type="range"]::-moz-range-thumb {
    pointer-events: all;
  }

  /* Re-enable pointer events for the thumb in Internet Explorer/Edge */
  input[type="range"]::-ms-thumb {
    pointer-events: all;
  }

  /*  */

  /*  */

  input[type="range"].heading::-webkit-slider-thumb {
    background-color: var(--accent-green);
  }

  input[type="range"].heading::-moz-range-thumb {
    background-color: var(--accent-green);
  }

  input[type="range"].heading::-ms-thumb {
    background-color: var(--accent-green);
  }


  input[type="range"].wind::-webkit-slider-thumb {
    background-color: var(--accent-blue);
  }

  input[type="range"].wind::-moz-range-thumb {
    background-color: var(--accent-blue);
  }

  input[type="range"].wind::-ms-thumb {
    background-color: var(--accent-blue);
  }
</style>
</head>
<body>
<div class="app">

  <header style="margin-top: 40px;">
    <h1>Доставка чебуреків</h1>
    <!-- <p class="lead">Dark theme. Drag arrows on dial or use sliders — live updates.</p> -->
  </header>

  <section class="card" style="margin-top: 20px;">
    <!-- Switch -->
    <!-- <div class="row">
      <div class="label-row"><div class="label">Available flight time</div><div class="value-pill" id="timePill">50 min</div></div>
      <div class="toggle"><button id="t50" class="active">50 minutes</button><button id="t100">100 minutes</button></div>
    </div> -->
    <!-- Controls card -->
    <!-- 1. Switch: 50 / 100 minutes -->
    <div class="row" style="margin-bottom:8px">
      <div class="label-row">
        <div class="label">Конфігурація</div>
        <div class="value-pill" id="timePill" style="display: none;">50 min</div>
      </div>
      <div style="margin-top:6px">
        <div class="toggle" role="tablist" aria-label="Select flight time">
          <button id="t50" class="active" role="tab" aria-selected="true">16/50</button>
          <button id="t100" role="tab" aria-selected="false">33/100</button>
        </div>
      </div>
    </div>

    <!-- Wind speed -->
    <div class="row" style="margin-top: 30px;">
      <div class="label-row"><div class="label">Швидкість вітру</div><div class="value-pill" id="windSpeedP">1 m/s</div></div>
      <input id="windSpeed" class="wind" type="range" min="1" max="15" value="1">
    </div>

    <!-- Wind direction -->
    <div class="row" style="margin-top: 0px;">
      <div class="label-row"><div class="label">Напрямок вітру</div><div class="value-pill" id="windDirP">0°</div></div>
      <input id="windDir" class="wind" type="range" min="0" max="360" value="0">
    </div>

    <!-- Heading -->
    <div class="row" style="margin-top: 0px;">
      <div class="label-row"><div class="label">Напрямок доставки</div><div class="value-pill" id="headingP">0°</div></div>
      <input id="heading" class="heading" type="range" min="0" max="360" value="0">
    </div>


    <!-- Wheel -->
    <div class="wheel-wrap" style="margin-top: 30px;">
      <svg id="wheel" class="wheel" viewBox="-160 -160 320 320">
        <circle cx="0" cy="0" r="120" fill="none" stroke="rgba(255,255,255,0.08)" stroke-width="8"/>
        <circle cx="0" cy="0" r="76" fill="none" stroke="rgba(255,255,255,0.05)"/>
        <g id="ticks"></g>
        <g id="nums"></g>

        <!-- Wind arrow (outer) -->
        <g id="windG" transform="rotate(0)">
          <polygon id="windArrow" points="-15,-130 15,-130 0,-150" fill="var(--accent-blue)"/>
          <circle cx="0" cy="0" r="6" fill="var(--accent-blue)"/>
        </g>

        <!-- Heading arrow (inner, closer to center) -->
        <g id="headG" transform="rotate(0)">
          <polygon id="headArrow" points="-15,-85 15,-85 0,-105" fill="var(--accent-green)"/>
          <circle cx="0" cy="0" r="6" fill="var(--accent-green)"/>
        </g>
      </svg>
    </div>


    <!-- Outputs -->
    <div class="row" style="margin-top: 30px;">
      <div style="display:flex;justify-content:space-between">
        <div><div class="output-large" id="rangeOut">— km</div><div class="output-sub">Максимальна відстань доставки</div></div>
        <div style="text-align:right"><div style="font-weight:700">Vₐ = 22 m/s</div><div class="output-sub" id="enduranceOut">— s</div></div>
      </div>
      <div class="output-sub" id="logicText"></div>
    </div>

    <br/>
    <br/>
    <br/>

  </section>

  <br/>
  <br/>
  <br/>
  <br/>
  <br/>
  <br/>
  <br/>
  <br/>
  <br/>

</div>

<script>
(()=> {
  const Va=22;
  let minutes=50;
  const el=(id)=>document.getElementById(id);
  const t50=el('t50'),t100=el('t100'),timePill=el('timePill');
  const windSpeed=el('windSpeed'),windSpeedP=el('windSpeedP');
  const windDir=el('windDir'),windDirP=el('windDirP');
  const heading=el('heading'),headingP=el('headingP');
  const windG=el('windG'),headG=el('headG');
  const rangeOut=el('rangeOut'),enduranceOut=el('enduranceOut'),logicText=el('logicText');
  const svg=el('wheel'),ticksG=el('ticks'),numsG=el('nums');

  // draw ticks
  for(let a=0;a<360;a+=10){
    const rad=(a-90)*Math.PI/180;
    const rOut=120, rIn=(a%30===0?108:114);
    const x1=Math.cos(rad)*rIn,y1=Math.sin(rad)*rIn;
    const x2=Math.cos(rad)*rOut,y2=Math.sin(rad)*rOut;
    const line=document.createElementNS('http://www.w3.org/2000/svg','line');
    line.setAttribute('x1',x1);line.setAttribute('y1',y1);
    line.setAttribute('x2',x2);line.setAttribute('y2',y2);
    line.setAttribute('stroke','rgba(255,255,255,0.15)');
    line.setAttribute('stroke-width',(a%30===0)?2:1);
    ticksG.appendChild(line);
    if(a%30===0){
      const txt=document.createElementNS('http://www.w3.org/2000/svg','text');
      txt.setAttribute('x',Math.cos(rad)*76);
      txt.setAttribute('y',Math.sin(rad)*76+4);
      txt.setAttribute('fill','rgba(255,255,255,0.5)');
      txt.setAttribute('font-size','10');txt.setAttribute('text-anchor','middle');
      txt.textContent=a;
      numsG.appendChild(txt);
    }
  }

  function deg2rad(d){return d*Math.PI/180;}
  function update(){
    windSpeedP.textContent=windSpeed.value+' m/s';
    windDirP.textContent=windDir.value+'°';
    headingP.textContent=heading.value+'°';
    timePill.textContent=minutes+' min';
    windG.setAttribute('transform','rotate('+windDir.value+')');
    headG.setAttribute('transform','rotate('+heading.value+')');
    compute();
  }
  function compute(){
    const W=+windSpeed.value, wd=+windDir.value, hd=+heading.value;
    const endurance=minutes*60;enduranceOut.textContent=endurance+' s';
    let phi=deg2rad(wd-hd);while(phi>Math.PI)phi-=2*Math.PI;while(phi<-Math.PI)phi+=2*Math.PI;
    const Wc=W*Math.sin(phi), Wa=W*Math.cos(phi);
    let flyable=Math.abs(Wc)<=Va;
    let Va_along=Math.sqrt(Math.max(Va*Va-Wc*Wc,0));
    let Vg=flyable?(Va_along+Wa):0;
    if(Vg<0)Vg=0;
    const range=Vg*endurance/1000;
    rangeOut.textContent=(flyable?range.toFixed(2):'0.00')+' km';
    logicText.textContent=`Va=${Va} m/s, W=${W} m/s, wind=${wd}°, heading=${hd}°. `+
      (flyable?`Vg=${Vg.toFixed(2)} m/s, Range=${range.toFixed(2)} km`:
      `Crosswind too strong → 0 km`);
  }

  t50.onclick=()=>{minutes=50;t50.classList.add('active');t100.classList.remove('active');update();}
  t100.onclick=()=>{minutes=100;t100.classList.add('active');t50.classList.remove('active');update();}
  windSpeed.oninput=update;
  windDir.oninput=update;
  heading.oninput=update;

  // drag on wheel
  function clientToAngle(x,y){
    const pt=svg.createSVGPoint();pt.x=x;pt.y=y;
    const sp=pt.matrixTransform(svg.getScreenCTM().inverse());
    let ang=Math.atan2(sp.y,sp.x)*180/Math.PI+90;
    return (ang+360)%360;
  }
  let drag=null;

  windG.addEventListener('pointerdown',(e)=>{
    const ang=clientToAngle(e.clientX,e.clientY);
    const dist=Math.hypot(e.clientX,e.clientY);
    
    drag = 'wind';
    if(drag==='wind')windDir.value=Math.round(ang); else heading.value=Math.round(ang);

    update();
    e.preventDefault();
  });

  headG.addEventListener('pointerdown',(e)=>{
    const ang=clientToAngle(e.clientX,e.clientY);
    const dist=Math.hypot(e.clientX,e.clientY);
    
    drag = 'heading';
    if(drag==='wind')windDir.value=Math.round(ang); else heading.value=Math.round(ang);

    update();
    e.preventDefault();
  });

  // svg.addEventListener('pointerdown',(e)=>{
  //   const ang=clientToAngle(e.clientX,e.clientY);
  //   const dist=Math.hypot(e.clientX,e.clientY);
  //   drag = (Math.abs(ang-heading.value) < Math.abs(ang-windDir.value) ? 'heading' : 'wind');
  //   // if(Math.abs(ang-heading.value) < 30) drag='heading'; else drag='wind';
  //   if(drag==='wind')windDir.value=Math.round(ang); else heading.value=Math.round(ang);
  //   update();
  //   e.preventDefault();
  // });


  svg.addEventListener('pointermove',(e)=>{if(!drag)return;const ang=clientToAngle(e.clientX,e.clientY);if(drag==='wind')windDir.value=Math.round(ang);else heading.value=Math.round(ang);update();});
  svg.addEventListener('pointerup',()=>drag=null);
  svg.addEventListener('pointerleave',()=>drag=null);

  update();
})();
</script>
</body>
</html>
